!function(e){function t(o){if(r[o])return r[o].exports;var n=r[o]={exports:{},id:o,loaded:!1};return e[o].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}var n=r(2),a=o(n);window.Lajax=a.default},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}();"toJSON"in Error.prototype||Object.defineProperty(Error.prototype,"toJSON",{value:function(){var e={};return Object.getOwnPropertyNames(this).forEach(function(t){e[t]=this[t]},this),e},configurable:!0,writable:!0});var a=function(){function e(t){r(this,e);var n=t;if("undefined"==typeof n)throw new Error("lajaxåˆå§‹åŒ–é”™è¯¯ - æž„é€ å‡½æ•°çš„å‚æ•°ä¸èƒ½ä¸ºç©ºï¼");if("string"==typeof n)n={url:t};else{if("object"!==("undefined"==typeof n?"undefined":o(n)))throw new Error("lajaxåˆå§‹åŒ–é”™è¯¯ - æž„é€ å‡½æ•°çš„å‚æ•°æ ¼å¼ä¸æ­£ç¡®ï¼");if("string"!=typeof t.url)throw new Error("lajaxåˆå§‹åŒ–é”™è¯¯ - æž„é€ å‡½æ•°çš„å‚æ•° url å¿…é¡»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼");if(null!=t.logAjaxFilter&&"function"!=typeof t.logAjaxFilter)throw new Error("lajaxåˆå§‹åŒ–é”™è¯¯ - æž„é€ å‡½æ•°çš„å‚æ•° logAjaxFilter å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ï¼");if(null!=t.customDesc&&"function"!=typeof t.customDesc)throw new Error("lajaxåˆå§‹åŒ–é”™è¯¯ - æž„é€ å‡½æ•°çš„å‚æ•° customDesc å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ï¼")}this.url=n.url,this.autoLogError=null==n.autoLogError||n.autoLogError,this.autoLogRejection=null==n.autoLogRejection||n.autoLogRejection,this.autoLogAjax=null==n.autoLogAjax||n.autoLogAjax;var a=function(e,t){return!0};this.logAjaxFilter=null==n.logAjaxFilter?a:n.logAjaxFilter,this.stylize=null==n.stylize||n.stylize,this.showDesc=null==n.showDesc||n.showDesc,this.customDesc=n.customDesc;var i=1e4;this.interval=null==n.interval?i:n.interval;var s=5;this.maxErrorReq=null==n.maxErrorReq?s:n.maxErrorReq,this.errorReq=0,this.queue=[],this.xhr=null,this.xhrOpen=XMLHttpRequest.prototype.open,this.xhrSend=XMLHttpRequest.prototype.send,this._init()}return n(e,[{key:"_init",value:function(){var e=this;this._getReqId(),this._loadFromStorage(),this._printDesc(),this._exceptionHandler(),this._ajaxHandler(),this._storageUnsendData(),this.timer=setInterval(function(){e._send()},this.interval)}},{key:"_getReqId",value:function(){if(this.reqId=document.querySelector('[name="_reqId"]')?document.querySelector('[name="_reqId"]').content:"",this.reqId||(this.reqId=window._reqId),this.reqId)this.idFromServer=!0;else{var e=Date.now();"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),this.reqId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?r:3&r|8).toString(16)}),this.idFromServer=!1}}},{key:"_defaultDesc",value:function(e,t,r){return"ðŸš€ lajax å‰ç«¯æ—¥å¿—æ¨¡å—åŠ è½½å®Œæˆã€‚\nè‡ªåŠ¨è®°å½•é¡µé¢é”™è¯¯ï¼š      "+(this.autoLogError?"âœ”":"âœ˜")+"\nè‡ªåŠ¨è®°å½•Promiseå¼‚å¸¸ï¼š   "+(this.autoLogRejection?"âœ”":"âœ˜")+"\nè‡ªåŠ¨è®°å½•Ajaxè¯·æ±‚ï¼š      "+(this.autoLogAjax?"âœ”":"âœ˜")+"\nå½“å‰é¡µé¢è¯·æ±‚idï¼š"+t+(r?" (æ¥è‡ªæœåŠ¡ç«¯)":" (è‡ªåŠ¨ç”Ÿæˆ)")}},{key:"_printDesc",value:function(){if(console&&this.showDesc){var t=void 0;t=this.customDesc?"%c"+this.customDesc(this.lastUnsend,this.reqId,this.idFromServer):"%c"+this._defaultDesc(this.lastUnsend,this.reqId,this.idFromServer),console.log(t,"color: "+e.colorEnum.desc+"; font-family: å®‹ä½“; line-height: 1.5;")}}},{key:"_isSecret",value:function(){try{var e="lajax-test";return window.localStorage.setItem(e,"1"),window.localStorage.removeItem(e),!1}catch(e){return!0}}},{key:"_loadFromStorage",value:function(){if(!this._isSecret()){var e=JSON.parse(window.localStorage.getItem("lajax"));Array.isArray(e)&&e.length&&(this.lastUnsend=e.length,this.queue=e,this._send()),window.localStorage.removeItem("lajax")}}},{key:"_exceptionHandler",value:function(){var e=this;this.autoLogError&&window.addEventListener("error",function(t){e.error("[OnError]",t.message,"("+t.lineno+"è¡Œ"+t.colno+"åˆ—)")}),this.autoLogRejection&&window.addEventListener("unhandledrejection",function(t){e.error("[OnRejection]",t.reason)})}},{key:"_ajaxHandler",value:function(){if(this.autoLogAjax){var t=this;XMLHttpRequest.prototype.open=function(){for(var e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];this._lajaxMethod=r[0],this._lajaxUrl=r[1],t.xhrOpen.apply(this,r)},XMLHttpRequest.prototype.send=function(r){var o=new Date;t.logAjaxFilter(this._lajaxUrl,this._lajaxMethod)&&(t._pushToQueue(o,e.levelEnum.info,"[ajax] å‘é€"+this._lajaxMethod.toLowerCase()+"è¯·æ±‚ï¼š"+this._lajaxUrl),this.setRequestHeader("X-Request-Id",t.reqId)),this.addEventListener("readystatechange",function(){if(t.logAjaxFilter(this._lajaxUrl,this._lajaxMethod))try{if(this.readyState===XMLHttpRequest.DONE){console&&console.group&&t.stylize&&console.group("%cajaxè¯·æ±‚","color: "+e.colorEnum.ajaxGroup+";"),t._printConsole(o,e.levelEnum.info,"[ajax] å‘é€"+this._lajaxMethod.toLowerCase()+"è¯·æ±‚ï¼š"+this._lajaxUrl);var n=new Date,a=(n-o)/1e3,i=[];this.status>=200&&this.status<400?i.push("æŽ¥å£è¯·æ±‚æˆåŠŸã€‚"):i.push("æŽ¥å£è¯·æ±‚å¤±è´¥ï¼"),i.push("è¯·æ±‚è€—æ—¶ï¼š"+a+"s URLï¼š"+this._lajaxUrl+" è¯·æ±‚æ–¹å¼ï¼š"+this._lajaxMethod),"post"===this._lajaxMethod.toLowerCase()&&i.push("è¡¨å•æ•°æ®ï¼š",JSON.parse(r)),i.push("çŠ¶æ€ç ï¼š"+this.status),this.status>=200&&this.status<400?t.info.apply(t,["[ajax]"].concat(i)):t.error.apply(t,["[ajax]"].concat(i)),console&&console.group&&console.groupEnd()}}catch(e){var s=[];s.push("æŽ¥å£è¯·æ±‚å‡ºé”™ï¼"),s.push("URLï¼š"+this._lajaxUrl+" è¯·æ±‚æ–¹å¼ï¼š"+this._lajaxMethod),"post"===this._lajaxMethod.toLowerCase()&&s.push("è¡¨å•æ•°æ®ï¼š",JSON.parse(r)),s.push("çŠ¶æ€ç ï¼š"+this.status),s.push("ERRORï¼š"+e),t.error.apply(t,["[ajax]"].concat(s))}}),t.xhrSend.call(this,r)}}}},{key:"_storageUnsendData",value:function(){var e=this;window.onunload=function(){e.queue.length&&(navigator.sendBeacon&&navigator.sendBeacon(e.url,JSON.stringify(e.queue))?e.queue=[]:e._isSecret()?e._send():window.localStorage.setItem("lajax",JSON.stringify(e.queue)))}}},{key:"_send",value:function(){var t=this,r=this.queue.length;r&&(this.xhr&&(this.xhr.onreadystatechange=null,this.xhr.abort()),this.xhr=new XMLHttpRequest,this.xhrOpen.call(this.xhr,"POST",this.url,!0),this.xhr.setRequestHeader("Content-Type","application/json; charset=utf-8"),this.xhrSend.call(this.xhr,JSON.stringify(this.queue)),this.xhr.onreadystatechange=function(){t.xhr.readyState===XMLHttpRequest.DONE&&(t.xhr.status>=200&&t.xhr.status<400?(t.queue.splice(0,r),t.errorReq=0,console&&(t.stylize?console.log("%c["+t._getTimeString(null)+"] - "+r+"æ¡æ—¥å¿—å‘é€æˆåŠŸï¼","color: "+e.colorEnum.sendSuccess):console.log(r+"æ¡æ—¥å¿—å‘é€æˆåŠŸï¼"))):(t._printConsole(null,e.levelEnum.error,"å‘é€æ—¥å¿—è¯·æ±‚å¤±è´¥ï¼é…ç½®çš„æŽ¥å£åœ°å€ï¼š"+t.url+" çŠ¶æ€ç ï¼š"+t.xhr.status),t._checkErrorReq()),t.xhr=null)})}},{key:"_checkErrorReq",value:function(){this.errorReq++,this.errorReq>=this.maxErrorReq&&(clearInterval(this.timer),window.console&&this._printConsole(null,e.levelEnum.warn,"å‘é€æ—¥å¿—è¯·æ±‚çš„è¿žç»­å¤±è´¥æ¬¡æ•°è¿‡å¤šï¼Œå·²åœæ­¢å‘é€æ—¥å¿—ã€‚è¯·æ£€æŸ¥æ—¥å¿—æŽ¥å£ "+this.url+" æ˜¯å¦æ­£å¸¸ï¼"))}},{key:"_getTimeString",value:function(e){var t=null===e?new Date:e,r=String(t.getHours());1===r.length&&(r="0"+r);var o=String(t.getMinutes());1===o.length&&(o="0"+o);var n=String(t.getSeconds());1===n.length&&(n="0"+n);var a=String(t.getMilliseconds());return 1===a.length?a="00"+a:2===a.length&&(a="0"+a),r+":"+o+":"+n+"."+a}},{key:"_getDateTimeString",value:function(e){var t=null===e?new Date:e,r=String(t.getFullYear()),o=String(t.getMonth()+1);1===o.length&&(o="0"+o);var n=String(t.getDate());return 1===n.length&&(n="0"+n),r+"-"+o+"-"+n+" "+this._getTimeString(t)}},{key:"_printConsole",value:function(t,r){if(console){for(var o=arguments.length,n=Array(o>2?o-2:0),a=2;a<o;a++)n[a-2]=arguments[a];if(this.stylize){var i;(i=console)[r].apply(i,["%c["+this._getTimeString(t)+"] ["+r.toUpperCase()+"] -","color: "+e.colorEnum[r]].concat(n))}else{var s;(s=console)[r].apply(s,n)}}}},{key:"_pushToQueue",value:function(e,t){for(var r=arguments.length,o=Array(r>2?r-2:0),n=2;n<r;n++)o[n-2]=arguments[n];o.unshift("{"+this.reqId+"}"),this.queue.push({time:this._getDateTimeString(e),level:t,messages:o,url:window.location.href,agent:navigator.userAgent})}},{key:"_log",value:function(e,t){for(var r=arguments.length,o=Array(r>2?r-2:0),n=2;n<r;n++)o[n-2]=arguments[n];this._printConsole.apply(this,[e,t].concat(o)),this._pushToQueue.apply(this,[e,t].concat(o))}},{key:"info",value:function(){for(var t=arguments.length,r=Array(t),o=0;o<t;o++)r[o]=arguments[o];this._log.apply(this,[null,e.levelEnum.info].concat(r))}},{key:"log",value:function(){this.info.apply(this,arguments)}},{key:"warn",value:function(){for(var t=arguments.length,r=Array(t),o=0;o<t;o++)r[o]=arguments[o];this._log.apply(this,[null,e.levelEnum.warn].concat(r))}},{key:"error",value:function(){for(var t=arguments.length,r=Array(t),o=0;o<t;o++)r[o]=arguments[o];this._log.apply(this,[null,e.levelEnum.error].concat(r))}}]),e}();a.levelEnum={info:"info",warn:"warn",error:"error"},a.colorEnum={info:"DodgerBlue",warn:"orange",error:"red",ajaxGroup:"#800080",sendSuccess:"green",desc:"#d30775"},t.default=a}]);